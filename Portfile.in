# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.1
PortGroup           github 1.0
PortGroup           boost 1.0

github.setup        sunshinestream sunshine master
version             @PROJECT_VERSION@
revision            1

categories          multimedia
license             GPL-3
maintainers         {sunshinestream @SunshineStream} {outlook.com:anselm.busse}
platforms           darwin

fetch.type          git
post-fetch {
    system -W ${worksrcpath} "${git.cmd} submodule update --init --recursive"
}

description         @PROJECT_DESCRIPTION@
long_description    {*}${description}
homepage            @PROJECT_HOMEPAGE_URL@

depends_lib         port:avahi \
                    port:ffmpeg \
                    port:libopus


boost.version       1.76

configure.args      -DBOOST_ROOT=[boost::install_area] \
                    -DSUNSHINE_ASSETS_DIR=${prefix}/usr/local/sunshine/.assets
                    -DSUNSHINE_CONFIG_DIR=${prefix}/usr/local/sunshine/config

cmake.out_of_source yes

destroot {
    xinstall -d -m 755 ${destroot}${prefix}/usr/local/${name}/.assets
    xinstall {*}[glob ${worksrcpath}/src_assets/common/assets/*] ${destroot}${prefix}/usr/local/${name}/.assets
    xinstall {*}[glob ${worksrcpath}/src_assets/macos/assets/*] ${destroot}${prefix}/usr/local/${name}/.assets

    xinstall -d -m 755 ${destroot}${prefix}/usr/local/${name}/config
    xinstall {*}[glob ${worksrcpath}/src_assets/common/config/*] ${destroot}${prefix}/usr/local/${name}/config
    xinstall {*}[glob ${worksrcpath}/src_assets/macos/config/*] ${destroot}${prefix}/usr/local/${name}/config

    xinstall ${workpath}/build/${name} ${destroot}${prefix}/bin
}
